<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Relatório de Visitas (Persistente)</title>
    <style>
        /* Estilos Globais */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #eef2f7;
            color: #333;
        }
        .container {
            max-width: 750px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #1e3a8a;
            margin-bottom: 30px;
            font-size: 2em;
        }
        h2 {
            text-align: center;
            color: #4b5563;
            margin-top: 20px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 5px;
        }
        
        /* Botões de Contagem (Estilo Aprimorado) */
        .botoes-contagem {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            gap: 20px;
        }
        .botao-grupo {
            flex-grow: 1;
            text-align: center;
        }
        .botao-grupo button {
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        #btnProcedente {
            background-color: #10b981; /* Verde esmeralda */
            color: white;
        }
        #btnProcedente:hover {
            background-color: #059669;
            transform: translateY(-2px);
        }
        #btnImprocedente {
            background-color: #ef4444; /* Vermelho vibrante */
            color: white;
        }
        #btnImprocedente:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
        }

        .contador-label {
            font-weight: 600;
            margin-top: 10px;
            font-size: 1.2em;
            color: #3b82f6; /* Azul moderno */
        }
        
        /* Botões de Geração de Relatório */
        .botoes-geracao {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 20px;
        }
        .botoes-geracao button {
            flex-grow: 1;
            padding: 12px 20px;
            font-size: 1em;
            font-weight: 600;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }
        #btnGerarParcial {
            background-color: #fcd34d; /* Amarelo ouro */
            color: #333;
        }
        #btnGerarParcial:hover {
            background-color: #fbbf24;
        }
        #btnGerarFinal {
            background-color: #3b82f6; /* Azul principal */
            color: white;
        }
        #btnGerarFinal:hover {
            background-color: #2563eb;
        }

        /* Área do Relatório */
        #relatorio {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            box-sizing: border-box;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            resize: vertical;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
            background-color: #f9fafb;
            font-size: 1em;
        }
        
        /* Botão de Copiar */
        #copiarRelatorio {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background-color: #14b8a6; /* Ciano moderno */
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        #copiarRelatorio:hover {
            background-color: #0d9488;
        }

        /* Mensagem de Feedback */
        .mensagem {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        #btnResetar {
            display: block;
            width: 100%;
            padding: 8px;
            margin-top: 15px;
            background-color: #f97316; /* Laranja */
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        #btnResetar:hover {
            background-color: #ea580c;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Controle de Visitas de Imóveis</h1>

    <div class="botoes-contagem">
        <div class="botao-grupo">
            <button id="btnProcedente">Procedente</button>
            <div class="contador-label">Contagem: <span id="contadorProcedente">0</span></div>
        </div>
        <div class="botao-grupo">
            <button id="btnImprocedente">Improcedente</button>
            <div class="contador-label">Contagem: <span id="contadorImprocedente">0</span></div>
        </div>
    </div>

    <h2>Gerar Relatório</h2>
    
    <div class="botoes-geracao">
        <button id="btnGerarParcial">Gerar Relatório Parcial</button>
        <button id="btnGerarFinal">Gerar Relatório Final</button>
    </div>

    <textarea id="relatorio" readonly placeholder="Gere um relatório Parcial ou Final para visualizar e copiar..."></textarea>

    <button id="copiarRelatorio">Copiar Relatório Gerado</button>
    
    <p class="mensagem" id="mensagemCopia"></p>

    <button id="btnResetar">RESETAR TODOS OS CONTADORES (Permanente)</button>
</div>

<script>
    // --- Persistência de Dados (localStorage) ---
    const KEY_PROCEDENTE = 'countProcedente';
    const KEY_IMPROCEDENTE = 'countImprocedente';

    let countProcedente = parseInt(localStorage.getItem(KEY_PROCEDENTE) || 0);
    let countImprocedente = parseInt(localStorage.getItem(KEY_IMPROCEDENTE) || 0);

    // Elementos do DOM
    const displayProcedente = document.getElementById('contadorProcedente');
    const displayImprocedente = document.getElementById('contadorImprocedente');
    const relatorioArea = document.getElementById('relatorio');
    const mensagemCopia = document.getElementById('mensagemCopia');

    // Inicializa a exibição com os valores salvos
    function init() {
        displayProcedente.textContent = countProcedente;
        displayImprocedente.textContent = countImprocedente;
    }

    // Salva os contadores no localStorage
    function salvarContadores() {
        localStorage.setItem(KEY_PROCEDENTE, countProcedente);
        localStorage.setItem(KEY_IMPROCEDENTE, countImprocedente);
    }

    // Função que lida com o clique nos botões de contagem
    function incrementarContador(tipo) {
        if (tipo === 'procedente') {
            countProcedente++;
        } else if (tipo === 'improcedente') {
            countImprocedente++;
        }
        
        displayProcedente.textContent = countProcedente;
        displayImprocedente.textContent = countImprocedente;
        
        salvarContadores(); // Salva a alteração
        relatorioArea.value = ""; 
        mensagemCopia.textContent = "";
    }
    
    // Função principal para gerar o texto do relatório
    function gerarTextoRelatorio(tipo) {
        const total = countProcedente + countImprocedente;
        const dataHora = new Date().toLocaleString('pt-BR');

        // Formato solicitado
        const relatorioTexto = `
RELATÓRIO ${tipo.toUpperCase()} - GERADO EM: ${dataHora}

IMÓVEIS VISITADOS: ${total}

PROCEDENTES: ${countProcedente}

IMPROCEDENTES: ${countImprocedente}
        `.trim(); 

        return relatorioTexto;
    }

    // Função para gerar o Relatório Parcial
    function gerarRelatorioParcial() {
        if (countProcedente + countImprocedente === 0) {
            alert("Nenhum imóvel visitado para gerar o relatório.");
            return;
        }
        relatorioArea.value = gerarTextoRelatorio("PARCIAL");
        mensagemCopia.textContent = "Relatório Parcial gerado.";
        mensagemCopia.style.backgroundColor = "#fcd34d30";
        mensagemCopia.style.color = "#a16207";
    }

    // Função para gerar o Relatório Final (sem resetar)
    function gerarRelatorioFinal() {
        if (countProcedente + countImprocedente === 0) {
            alert("Nenhum imóvel visitado para gerar o relatório final.");
            return;
        }

        relatorioArea.value = gerarTextoRelatorio("FINAL");
        
        mensagemCopia.textContent = "Relatório FINAL gerado. Contagens mantidas.";
        mensagemCopia.style.backgroundColor = "#3b82f630";
        mensagemCopia.style.color = "#1e40af";
    }

    // Função para copiar o texto do relatório
    function copiarRelatorio() {
        if (relatorioArea.value === "") {
            mensagemCopia.textContent = "Gere um relatório Parcial ou Final primeiro!";
            mensagemCopia.style.backgroundColor = "#fecaca";
            mensagemCopia.style.color = "#b91c1c";
            return;
        }

        relatorioArea.select(); 
        relatorioArea.setSelectionRange(0, 99999); 
        
        navigator.clipboard.writeText(relatorioArea.value).then(() => {
            mensagemCopia.textContent = '✅ Relatório copiado com sucesso para a área de transferência!';
            mensagemCopia.style.backgroundColor = "#a7f3d0";
            mensagemCopia.style.color = "#047857";
            setTimeout(() => {
                mensagemCopia.textContent = '';
                mensagemCopia.style.backgroundColor = "transparent";
            }, 3000);
        }).catch(err => {
            // Fallback
            mensagemCopia.textContent = 'Erro ao copiar. Por favor, selecione e use Ctrl+C.';
            mensagemCopia.style.backgroundColor = "#fecaca";
            mensagemCopia.style.color = "#b91c1c";
        });
    }

    // Função para resetar manualmente todos os contadores
    function resetarContadores() {
        if (confirm("ATENÇÃO: Você tem certeza que deseja RESETAR permanentemente todos os contadores? Esta ação não pode ser desfeita.")) {
            countProcedente = 0;
            countImprocedente = 0;
            salvarContadores();
            init(); // Atualiza a tela
            relatorioArea.value = "";
            mensagemCopia.textContent = "Contadores resetados para 0 e salvos.";
            mensagemCopia.style.backgroundColor = "#fed7aa";
            mensagemCopia.style.color = "#c2410c";
        }
    }

    // Adiciona os event listeners
    document.getElementById('btnProcedente').addEventListener('click', () => incrementarContador('procedente'));
    document.getElementById('btnImprocedente').addEventListener('click', () => incrementarContador('improcedente'));
    document.getElementById('btnGerarParcial').addEventListener('click', gerarRelatorioParcial);
    document.getElementById('btnGerarFinal').addEventListener('click', gerarRelatorioFinal);
    document.getElementById('copiarRelatorio').addEventListener('click', copiarRelatorio);
    document.getElementById('btnResetar').addEventListener('click', resetarContadores);

    // Inicializa a página
    init();
</script>

</body>
</html>
