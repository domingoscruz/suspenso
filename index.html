<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Relatório de Visitas (Avançado)</title>
    <style>
        /* Estilos Globais */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #eef2f7;
            color: #333;
        }
        .container {
            max-width: 750px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #1e3a8a;
            margin-bottom: 30px;
            font-size: 2em;
        }
        h2 {
            text-align: center;
            color: #4b5563;
            margin-top: 20px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 5px;
        }
        
        /* Botões de Contagem (Estilo Aprimorado e Alinhamento) */
        .botoes-contagem {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            gap: 20px;
        }
        .botao-grupo {
            flex-grow: 1;
            text-align: center;
            display: flex; /* Adicionado para alinhar verticalmente */
            flex-direction: column; /* Coloca os itens em coluna */
            align-items: center; /* Centraliza horizontalmente */
        }
        
        .botoes-incremento-decremento {
            display: flex;
            align-items: center;
            gap: 10px; /* Espaço entre os botões */
            width: 100%; /* Ocupa a largura total do grupo */
            max-width: 250px; /* Limite para botões */
            margin-bottom: 10px;
        }

        .botao-grupo button {
            padding: 15px 10px; /* Ajustado para melhor proporção */
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
        }
        
        /* Botão de Incremento Principal */
        .botoes-incremento-decremento > button:first-child {
            flex-grow: 3; /* Faz o botão principal ser maior */
            padding: 15px 30px;
        }

        /* Botão de Decremento (-1) */
        .btn-decremento {
            padding: 8px 10px !important;
            font-size: 1.2em !important;
            font-weight: bold;
            flex-grow: 1;
            background-color: #9ca3af !important; /* Cinza */
            color: white !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .btn-decremento:hover {
            background-color: #6b7280 !important;
            transform: translateY(-1px);
        }

        #btnProcedente {
            background-color: #10b981; /* Verde esmeralda */
            color: white;
        }
        #btnProcedente:hover {
            background-color: #059669;
            transform: translateY(-2px);
        }
        #btnImprocedente {
            background-color: #ef4444; /* Vermelho vibrante */
            color: white;
        }
        #btnImprocedente:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
        }

        .contador-label {
            font-weight: 600;
            margin-top: 10px;
            font-size: 1.2em;
            color: #3b82f6; 
        }
        
        /* Botões de Geração de Relatório */
        .botoes-geracao {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 20px;
        }
        .botoes-geracao button {
            flex-grow: 1;
            padding: 12px 20px;
            font-size: 1em;
            font-weight: 600;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }
        #btnGerarParcial {
            background-color: #fcd34d; 
            color: #333;
        }
        #btnGerarParcial:hover {
            background-color: #fbbf24;
        }
        #btnGerarFinal {
            background-color: #3b82f6; 
            color: white;
        }
        #btnGerarFinal:hover {
            background-color: #2563eb;
        }

        /* Área do Relatório e Cópia (Sem alterações significativas) */
        #relatorio {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            box-sizing: border-box;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            resize: vertical;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
            background-color: #f9fafb;
            font-size: 1em;
        }
        
        #copiarRelatorio {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background-color: #14b8a6; 
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        #copiarRelatorio:hover {
            background-color: #0d9488;
        }

        /* Mensagem de Feedback e Reset */
        .mensagem {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        #btnResetar {
            display: block;
            width: 100%;
            padding: 8px;
            margin-top: 15px;
            background-color: #f97316; 
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        #btnResetar:hover:not(:disabled) {
            background-color: #ea580c;
        }
        #btnResetar:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Controle de Visitas de Imóveis</h1>

    <div class="botoes-contagem">
        <div class="botao-grupo">
            <div class="botoes-incremento-decremento">
                <button id="btnProcedente">+1 Procedente</button>
                <button class="btn-decremento" id="btnRemoverProcedente">-1</button>
            </div>
            <div class="contador-label">Contagem: <span id="contadorProcedente">0</span></div>
        </div>
        <div class="botao-grupo">
            <div class="botoes-incremento-decremento">
                <button id="btnImprocedente">+1 Improcedente</button>
                <button class="btn-decremento" id="btnRemoverImprocedente">-1</button>
            </div>
            <div class="contador-label">Contagem: <span id="contadorImprocedente">0</span></div>
        </div>
    </div>

    <h2>Gerar Relatório</h2>
    
    <div class="botoes-geracao">
        <button id="btnGerarParcial">Gerar Relatório Parcial</button>
        <button id="btnGerarFinal">Gerar Relatório Final</button>
    </div>

    <textarea id="relatorio" readonly placeholder="Gere um relatório Parcial ou Final para visualizar e copiar..."></textarea>

    <button id="copiarRelatorio">Copiar Relatório Gerado</button>
    
    <p class="mensagem" id="mensagemCopia"></p>

    <button id="btnResetar">RESETAR TODOS OS CONTADORES (Precisa de Confirmação)</button>
</div>

<script>
    // --- Configuração de Persistência e Variáveis ---
    const KEY_PROCEDENTE = 'countProcedente';
    const KEY_IMPROCEDENTE = 'countImprocedente';
    const COOLDOWN_RESET_SECONDS = 5; // Tempo de espera para o reset

    let countProcedente = parseInt(localStorage.getItem(KEY_PROCEDENTE) || 0);
    let countImprocedente = parseInt(localStorage.getItem(KEY_IMPROCEDENTE) || 0);
    let isResetConfirmed = false;
    let resetTimer = null;

    // Elementos do DOM
    const displayProcedente = document.getElementById('contadorProcedente');
    const displayImprocedente = document.getElementById('contadorImprocedente');
    const relatorioArea = document.getElementById('relatorio');
    const mensagemCopia = document.getElementById('mensagemCopia');
    const btnResetar = document.getElementById('btnResetar');

    // --- Funções de Estado e Persistência ---

    function init() {
        displayProcedente.textContent = countProcedente;
        displayImprocedente.textContent = countImprocedente;
    }

    function salvarContadores() {
        localStorage.setItem(KEY_PROCEDENTE, countProcedente);
        localStorage.setItem(KEY_IMPROCEDENTE, countImprocedente);
    }

    function limparFeedback() {
        relatorioArea.value = ""; 
        mensagemCopia.textContent = "";
        mensagemCopia.style.backgroundColor = "transparent";
    }

    // --- Funções de Contagem ---

    function alterarContador(tipo, valor) {
        if (tipo === 'procedente') {
            countProcedente = Math.max(0, countProcedente + valor); // Garante que não fica negativo
            displayProcedente.textContent = countProcedente;
        } else if (tipo === 'improcedente') {
            countImprocedente = Math.max(0, countImprocedente + valor);
            displayImprocedente.textContent = countImprocedente;
        }
        
        salvarContadores();
        limparFeedback();
    }

    // --- Funções de Relatório ---

    function gerarTextoRelatorio(tipo) {
        const total = countProcedente + countImprocedente;
        let cabecalho;
        
        if (tipo === 'PARCIAL') {
            const dataHora = new Date().toLocaleString('pt-BR');
            cabecalho = `RELATÓRIO PARCIAL - GERADO EM: ${dataHora}`;
        } else { // FINAL
            cabecalho = `RELATÓRIO FINAL`; // Sem data, conforme solicitado
        }

        const relatorioTexto = `
${cabecalho}

IMÓVEIS VISITADOS: ${total}

PROCEDENTES: ${countProcedente}

IMPROCEDENTES: ${countImprocedente}
        `.trim(); 

        return relatorioTexto;
    }

    function gerarRelatorio(tipo) {
        if (countProcedente + countImprocedente === 0) {
            alert("Nenhum imóvel visitado para gerar o relatório.");
            return;
        }
        relatorioArea.value = gerarTextoRelatorio(tipo);

        if (tipo === 'PARCIAL') {
            mensagemCopia.textContent = "Relatório Parcial gerado.";
            mensagemCopia.style.backgroundColor = "#fcd34d30";
            mensagemCopia.style.color = "#a16207";
        } else { // FINAL
            mensagemCopia.textContent = "Relatório FINAL gerado. Contagens mantidas.";
            mensagemCopia.style.backgroundColor = "#3b82f630";
            mensagemCopia.style.color = "#1e40af";
        }
    }

    // --- Função de Cópia (Sem alterações significativas) ---

    function copiarRelatorio() {
        if (relatorioArea.value === "") {
            mensagemCopia.textContent = "Gere um relatório Parcial ou Final primeiro!";
            mensagemCopia.style.backgroundColor = "#fecaca";
            mensagemCopia.style.color = "#b91c1c";
            return;
        }

        relatorioArea.select(); 
        relatorioArea.setSelectionRange(0, 99999); 
        
        navigator.clipboard.writeText(relatorioArea.value).then(() => {
            mensagemCopia.textContent = '✅ Relatório copiado com sucesso para a área de transferência!';
            mensagemCopia.style.backgroundColor = "#a7f3d0";
            mensagemCopia.style.color = "#047857";
            setTimeout(() => {
                mensagemCopia.textContent = '';
                mensagemCopia.style.backgroundColor = "transparent";
            }, 3000);
        }).catch(err => {
            mensagemCopia.textContent = 'Erro ao copiar. Por favor, selecione e use Ctrl+C.';
            mensagemCopia.style.backgroundColor = "#fecaca";
            mensagemCopia.style.color = "#b91c1c";
        });
    }

    // --- Função de Reset com Confirmação e Cooldown ---

    function efetuarReset() {
        countProcedente = 0;
        countImprocedente = 0;
        salvarContadores();
        init(); 
        limparFeedback();
        
        mensagemCopia.textContent = "Contadores resetados para 0 e salvos PERMANENTEMENTE.";
        mensagemCopia.style.backgroundColor = "#fed7aa";
        mensagemCopia.style.color = "#c2410c";
        
        // Finaliza o estado de confirmação e cooldown
        isResetConfirmed = false;
        btnResetar.textContent = 'RESETAR TODOS OS CONTADORES (Precisa de Confirmação)';
        btnResetar.disabled = false;
        clearTimeout(resetTimer);
        resetTimer = null;
    }

    function resetarContadores() {
        if (!isResetConfirmed) {
            // Primeiro clique: Inicia o cooldown e pede confirmação
            
            isResetConfirmed = true;
            btnResetar.disabled = true;
            let tempoRestante = COOLDOWN_RESET_SECONDS;
            
            mensagemCopia.textContent = `Aperte novamente em ${tempoRestante}s para confirmar o RESET.`;
            mensagemCopia.style.backgroundColor = "#fef08a";
            mensagemCopia.style.color = "#a16207";

            btnResetar.textContent = `Aguarde para Confirmar (${tempoRestante}s)`;

            const interval = setInterval(() => {
                tempoRestante--;
                if (tempoRestante > 0) {
                    btnResetar.textContent = `Aguarde para Confirmar (${tempoRestante}s)`;
                    mensagemCopia.textContent = `Aperte novamente em ${tempoRestante}s para confirmar o RESET.`;
                } else {
                    clearInterval(interval);
                    btnResetar.disabled = false;
                    btnResetar.textContent = 'CLIQUE PARA CONFIRMAR O RESET!';
                    mensagemCopia.textContent = 'CONFIRME O RESET AGORA!';
                }
            }, 1000);

            resetTimer = setTimeout(() => {
                // Se o usuário não clicou após o cooldown, volta ao estado inicial
                if (isResetConfirmed) {
                    isResetConfirmed = false;
                    btnResetar.textContent = 'RESETAR TODOS OS CONTADORES (Precisa de Confirmação)';
                    mensagemCopia.textContent = '';
                    mensagemCopia.style.backgroundColor = "transparent";
                }
            }, COOLDOWN_RESET_SECONDS * 1000);

        } else if (btnResetar.disabled === false) {
            // Segundo clique (após o cooldown): Efetua o reset
            efetuarReset();
        }
    }

    // --- Event Listeners ---
    document.getElementById('btnProcedente').addEventListener('click', () => alterarContador('procedente', 1));
    document.getElementById('btnImprocedente').addEventListener('click', () => alterarContador('improcedente', 1));
    document.getElementById('btnRemoverProcedente').addEventListener('click', () => alterarContador('procedente', -1));
    document.getElementById('btnRemoverImprocedente').addEventListener('click', () => alterarContador('improcedente', -1));
    document.getElementById('btnGerarParcial').addEventListener('click', () => gerarRelatorio('PARCIAL'));
    document.getElementById('btnGerarFinal').addEventListener('click', () => gerarRelatorio('FINAL'));
    document.getElementById('copiarRelatorio').addEventListener('click', copiarRelatorio);
    btnResetar.addEventListener('click', resetarContadores);

    // Inicializa a página
    init();
</script>

</body>
</html>
agemCopia.textContent = '';
                mensagemCopia.style.backgroundColor = "transparent";
            }, 3000);
        }).catch(err => {
            // Fallback
            mensagemCopia.textContent = 'Erro ao copiar. Por favor, selecione e use Ctrl+C.';
            mensagemCopia.style.backgroundColor = "#fecaca";
            mensagemCopia.style.color = "#b91c1c";
        });
    }

    // Função para resetar manualmente todos os contadores
    function resetarContadores() {
        if (confirm("ATENÇÃO: Você tem certeza que deseja RESETAR permanentemente todos os contadores? Esta ação não pode ser desfeita.")) {
            countProcedente = 0;
            countImprocedente = 0;
            salvarContadores();
            init(); // Atualiza a tela
            relatorioArea.value = "";
            mensagemCopia.textContent = "Contadores resetados para 0 e salvos.";
            mensagemCopia.style.backgroundColor = "#fed7aa";
            mensagemCopia.style.color = "#c2410c";
        }
    }

    // Adiciona os event listeners
    document.getElementById('btnProcedente').addEventListener('click', () => incrementarContador('procedente'));
    document.getElementById('btnImprocedente').addEventListener('click', () => incrementarContador('improcedente'));
    document.getElementById('btnGerarParcial').addEventListener('click', gerarRelatorioParcial);
    document.getElementById('btnGerarFinal').addEventListener('click', gerarRelatorioFinal);
    document.getElementById('copiarRelatorio').addEventListener('click', copiarRelatorio);
    document.getElementById('btnResetar').addEventListener('click', resetarContadores);

    // Inicializa a página
    init();
</script>

</body>
</html>
