<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Relatório de Visitas (Edição Direta)</title>
    <style>
        /* Variáveis CSS */
        :root {
            --cor-principal: #1e3a8a;
            --cor-secundaria: #3b82f6;
            --cor-sucesso: #10b981;
            --cor-erro: #ef4444;
            --cor-aviso: #fcd34d;
        }

        /* Estilos Globais e Reset Básico */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 1.5rem; 
            background-color: #eef2f7;
            color: #333;
        }
        .container {
            max-width: 750px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: var(--cor-principal);
            margin-bottom: 1.5rem;
            font-size: 1.8rem; 
        }
        h2 {
            text-align: center;
            color: #4b5563;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
            font-size: 1.3rem; 
        }
        
        /* Botões de Contagem */
        .botoes-contagem {
            display: flex;
            justify-content: space-around;
            margin-bottom: 1.5rem;
            gap: 1rem;
        }
        .botao-grupo {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .botoes-incremento-decremento {
            display: flex;
            align-items: stretch; 
            gap: 0.5rem;
            width: 100%; 
            max-width: 250px; 
        }

        .botao-grupo button {
            padding: 0.8rem 0.5rem; 
            font-size: 1rem; 
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
        }
        
        /* Botão de Incremento Principal (+1) */
        .botoes-incremento-decremento > button:first-child {
            flex-grow: 3; 
            padding: 1rem 0.8rem; 
            font-size: 1.1rem;
        }

        /* Botão de Decremento (-1) */
        .btn-decremento {
            padding: 0.5rem 0.6rem !important;
            font-size: 1rem !important;
            background-color: #9ca3af !important; 
            color: white !important;
        }
        .btn-decremento:hover {
            background-color: #6b7280 !important;
            transform: translateY(-1px);
        }

        #btnProcedente {
            background-color: var(--cor-sucesso);
            color: white;
        }
        #btnProcedente:hover {
            background-color: #059669;
            transform: translateY(-2px);
        }
        #btnImprocedente {
            background-color: var(--cor-erro);
            color: white;
        }
        #btnImprocedente:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
        }

        /* Estilo da área de Contagem (para edição) */
        .contador-label {
            font-weight: 600;
            margin-top: 0.8rem;
            font-size: 1.1rem;
            color: var(--cor-secundaria);
        }
        .contador-display {
            font-weight: bold;
            color: var(--cor-principal);
            cursor: pointer; /* Indica que é clicável */
            padding: 0 5px; /* Espaço para clicar */
            display: inline-block;
            transition: color 0.2s;
        }
        .contador-display:hover {
            color: var(--cor-secundaria);
            text-decoration: underline;
        }
        .contador-input {
            width: 3rem;
            font-size: 1.1rem;
            font-weight: bold;
            text-align: center;
            border: 1px solid var(--cor-secundaria);
            border-radius: 4px;
            padding: 0 2px;
            box-sizing: border-box;
        }
        
        /* Botões de Geração de Relatório */
        .botoes-geracao {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .botoes-geracao button {
            flex-grow: 1;
            padding: 0.8rem 1rem;
            font-size: 0.95rem;
            font-weight: 600;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #btnGerarParcial {
            background-color: var(--cor-aviso); 
            color: #333;
        }
        #btnGerarFinal {
            background-color: var(--cor-secundaria); 
            color: white;
        }

        /* Área do Relatório */
        #relatorio {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            box-sizing: border-box;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            resize: vertical;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
            background-color: #f9fafb;
            font-size: 0.9rem;
        }
        
        /* Botão de Copiar e Reset */
        #copiarRelatorio {
            display: block;
            width: 100%;
            padding: 0.8rem;
            margin-top: 1rem;
            background-color: #14b8a6; 
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
        }
        #copiarRelatorio:hover {
            background-color: #0d9488;
        }

        /* Estilo do Botão de Reset (Base e Carregamento) */
        #btnResetar {
            display: block;
            width: 100%;
            padding: 0.6rem;
            margin-top: 1rem;
            background-color: #f97316; 
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: background-color 0.2s;
            position: relative; 
            overflow: hidden; 
        }
        #btnResetar:hover:not(:disabled) { background-color: #ea580c; }
        #btnResetar:disabled { background-color: #ff9d5e; cursor: wait; }
        #btnResetar:disabled::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateX(-100%);
            animation: loading-bar 5s linear forwards; 
        }
        @keyframes loading-bar { to { transform: translateX(0); } }

        /* Mensagem de Feedback */
        .mensagem {
            text-align: center;
            margin-top: 1rem;
            padding: 0.5rem;
            border-radius: 4px;
            font-weight: bold;
        }

        /* Media Query para Celulares */
        @media (max-width: 600px) {
            body { padding: 1rem; }
            .container { padding: 1rem; }
            h1 { font-size: 1.5rem; }
            .botoes-contagem { flex-direction: column; gap: 1.5rem; }
            .botao-grupo { padding: 0 0.5rem; }
            .botoes-geracao { flex-direction: column; gap: 0.5rem; }
            .botoes-geracao button { padding: 0.7rem 1rem; }
            #relatorio { font-size: 0.85rem; min-height: 120px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Controle de Visitas de Imóveis</h1>

    <div class="botoes-contagem">
        <div class="botao-grupo">
            <div class="botoes-incremento-decremento">
                <button id="btnProcedente">+1 Procedente</button>
                <button class="btn-decremento" id="btnRemoverProcedente">-1</button>
            </div>
            <div class="contador-label">
                Contagem: <span id="contadorProcedente" class="contador-display">0</span>
            </div>
        </div>
        <div class="botao-grupo">
            <div class="botoes-incremento-decremento">
                <button id="btnImprocedente">+1 Improcedente</button>
                <button class="btn-decremento" id="btnRemoverImprocedente">-1</button>
            </div>
            <div class="contador-label">
                Contagem: <span id="contadorImprocedente" class="contador-display">0</span>
            </div>
        </div>
    </div>

    <h2>Gerar Relatório</h2>
    
    <div class="botoes-geracao">
        <button id="btnGerarParcial">Gerar Relatório Parcial</button>
        <button id="btnGerarFinal">Gerar Relatório Final</button>
    </div>

    <textarea id="relatorio" readonly placeholder="Gere um relatório Parcial ou Final para visualizar e copiar..."></textarea>

    <button id="copiarRelatorio">Copiar Relatório Gerado</button>
    
    <p class="mensagem" id="mensagemCopia"></p>

    <button id="btnResetar">RESETAR TODOS OS CONTADORES</button>
</div>

<script>
    // --- Configuração de Persistência e Variáveis ---
    const KEY_PROCEDENTE = 'countProcedente';
    const KEY_IMPROCEDENTE = 'countImprocedente';
    const COOLDOWN_RESET_MS = 5000; 

    let countProcedente = parseInt(localStorage.getItem(KEY_PROCEDENTE) || 0);
    let countImprocedente = parseInt(localStorage.getItem(KEY_IMPROCEDENTE) || 0);

    // Elementos do DOM
    const displayProcedente = document.getElementById('contadorProcedente');
    const displayImprocedente = document.getElementById('contadorImprocedente');
    const relatorioArea = document.getElementById('relatorio');
    const mensagemCopia = document.getElementById('mensagemCopia');
    const btnResetar = document.getElementById('btnResetar');
    const initialResetText = btnResetar.textContent;

    // --- Funções de Estado e Persistência ---

    function init() {
        displayProcedente.textContent = countProcedente;
        displayImprocedente.textContent = countImprocedente;
    }

    function salvarContadores() {
        localStorage.setItem(KEY_PROCEDENTE, countProcedente);
        localStorage.setItem(KEY_IMPROCEDENTE, countImprocedente);
    }

    // --- Funções de Contagem (Incremento/Decremento) ---

    function alterarContador(tipo, valor) {
        let currentCount;
        if (tipo === 'procedente') {
            currentCount = countProcedente;
        } else {
            currentCount = countImprocedente;
        }

        currentCount = Math.max(0, currentCount + valor);

        if (tipo === 'procedente') {
            countProcedente = currentCount;
            displayProcedente.textContent = countProcedente;
        } else {
            countImprocedente = currentCount;
            displayImprocedente.textContent = countImprocedente;
        }
        
        salvarContadores();
        
        if (relatorioArea.value !== "") {
             relatorioArea.value = ""; 
        }
        mensagemCopia.textContent = '';
        mensagemCopia.style.backgroundColor = 'transparent';
    }

    // --- Funções de Edição Direta (Novo) ---

    function saveCount(element, key) {
        const input = element.querySelector('input');
        if (!input) return;

        let newValue = parseInt(input.value);

        // Validação
        if (isNaN(newValue) || newValue < 0) {
            newValue = 0; // Se inválido, define como 0
        }

        // Atualiza a variável global e o localStorage
        if (key === KEY_PROCEDENTE) {
            countProcedente = newValue;
        } else if (key === KEY_IMPROCEDENTE) {
            countImprocedente = newValue;
        }
        salvarContadores();
        
        // Retorna ao estado de exibição
        element.innerHTML = newValue;

        // Limpa feedback
        mensagemCopia.textContent = '';
        mensagemCopia.style.backgroundColor = 'transparent';
        relatorioArea.value = "";
    }

    function enableEditing(event) {
        const span = event.target;
        const currentCount = span.textContent;
        const key = span.id === 'contadorProcedente' ? KEY_PROCEDENTE : KEY_IMPROCEDENTE;
        
        // Cria o campo de input
        const input = document.createElement('input');
        input.type = 'number';
        input.value = currentCount;
        input.min = 0;
        input.className = 'contador-input';

        // Substitui o span pelo input
        span.parentNode.replaceChild(input, span);
        input.focus();
        input.select();

        // Evento para salvar ao sair do foco
        input.addEventListener('blur', () => {
            saveCount(input.parentNode, key);
        });

        // Evento para salvar ao pressionar Enter
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveCount(input.parentNode, key);
            }
        });
    }


    // --- Funções de Relatório ---

    function gerarTextoRelatorio(tipo) {
        const total = countProcedente + countImprocedente;
        const cabecalho = `RELATÓRIO ${tipo.toUpperCase()}`;
        
        return `
${cabecalho}

IMÓVEIS VISITADOS: ${total}

PROCEDENTES: ${countProcedente}

IMPROCEDENTES: ${countImprocedente}
        `.trim(); 
    }

    function gerarRelatorio(tipo) {
        if (countProcedente + countImprocedente === 0) {
            alert("Nenhum imóvel visitado para gerar o relatório.");
            return;
        }
        relatorioArea.value = gerarTextoRelatorio(tipo);

        if (tipo === 'PARCIAL') {
            mensagemCopia.textContent = "Relatório Parcial gerado.";
            mensagemCopia.style.backgroundColor = "#fcd34d30";
            mensagemCopia.style.color = "#a16207";
        } else {
            mensagemCopia.textContent = "Relatório FINAL gerado. Contagens mantidas.";
            mensagemCopia.style.backgroundColor = "#3b82f630";
            mensagemCopia.style.color = "#1e40af";
        }
    }

    // --- Função de Cópia ---

    function copiarRelatorio() {
        if (relatorioArea.value === "") {
            mensagemCopia.textContent = "Gere um relatório Parcial ou Final primeiro!";
            mensagemCopia.style.backgroundColor = "#fecaca";
            mensagemCopia.style.color = "#b91c1c";
            return;
        }
        // Lógica de cópia... (mantida)
        relatorioArea.select(); 
        relatorioArea.setSelectionRange(0, 99999); 
        
        navigator.clipboard.writeText(relatorioArea.value).then(() => {
            mensagemCopia.textContent = '✅ Relatório copiado com sucesso para a área de transferência!';
            mensagemCopia.style.backgroundColor = "#a7f3d0";
            mensagemCopia.style.color = "#047857";
            setTimeout(() => {
                mensagemCopia.textContent = '';
                mensagemCopia.style.backgroundColor = "transparent";
            }, 3000);
        }).catch(err => {
            mensagemCopia.textContent = 'Erro ao copiar. Por favor, selecione e use Ctrl+C.';
            mensagemCopia.style.backgroundColor = "#fecaca";
            mensagemCopia.style.color = "#b91c1c";
        });
    }

    // --- Função de Reset com Carregamento Visual ---

    function efetuarReset() {
        countProcedente = 0;
        countImprocedente = 0;
        salvarContadores();
        init(); 
        relatorioArea.value = ""; 
        
        // Restaura o botão
        btnResetar.disabled = false;
        btnResetar.textContent = initialResetText;
        btnResetar.style.animation = 'none';
        void btnResetar.offsetWidth; 
        btnResetar.style.animation = null;

        mensagemCopia.textContent = "✅ Contadores resetados para 0 e salvos.";
        mensagemCopia.style.backgroundColor = "#fed7aa";
        mensagemCopia.style.color = "#c2410c";
        
        setTimeout(() => {
            mensagemCopia.textContent = '';
            mensagemCopia.style.backgroundColor = 'transparent';
        }, 3000);
    }

    function iniciarCarregamentoReset() {
        if (btnResetar.disabled) return;

        btnResetar.disabled = true;
        
        btnResetar.style.animation = 'loading-bar 5s linear forwards';

        let tempoRestante = COOLDOWN_RESET_MS / 1000;
        
        const interval = setInterval(() => {
            tempoRestante--;
            if (tempoRestante >= 0) {
                btnResetar.textContent = `Aguardando Reset Total (${tempoRestante}s)`;
            } else {
                clearInterval(interval);
            }
        }, 1000);
        
        setTimeout(efetuarReset, COOLDOWN_RESET_MS);

        mensagemCopia.textContent = 'Aguarde 5 segundos. O reset será efetuado automaticamente.';
        mensagemCopia.style.backgroundColor = "#fef08a";
        mensagemCopia.style.color = "#a16207";
    }

    // --- Event Listeners ---
    document.getElementById('btnProcedente').addEventListener('click', () => alterarContador('procedente', 1));
    document.getElementById('btnImprocedente').addEventListener('click', () => alterarContador('improcedente', 1));
    document.getElementById('btnRemoverProcedente').addEventListener('click', () => alterarContador('procedente', -1));
    document.getElementById('btnRemoverImprocedente').addEventListener('click', () => alterarContador('improcedente', -1));
    
    // Novo: Evento de clique para edição direta
    displayProcedente.addEventListener('click', enableEditing);
    displayImprocedente.addEventListener('click', enableEditing);
    
    document.getElementById('btnGerarParcial').addEventListener('click', () => gerarRelatorio('PARCIAL'));
    document.getElementById('btnGerarFinal').addEventListener('click', () => gerarRelatorio('FINAL'));
    document.getElementById('copiarRelatorio').addEventListener('click', copiarRelatorio);
    btnResetar.addEventListener('click', iniciarCarregamentoReset);

    // Inicializa a página
    init();
</script>

</body>
</html>
